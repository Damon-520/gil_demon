{"host":"bogon","level":"error","msg":"failed to initialize database, got error %v/Users/liyu/Go/gil_teacher/app/core/mysqlx/mysql.go:20Error 1045 (28000): Access denied for user 'root'@'10.1.70.251' (using password: YES) to database 'nacos'","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:19+08:00","x_module":"util/gorm"}
{"host":"bogon","level":"error","msg":"failed to initialize database, got error %v/Users/liyu/Go/gil_teacher/app/core/mysqlx/mysql.go:20Error 1045 (28000): Access denied for user 'root'@'10.1.70.251' (using password: YES) to database 'nacos'","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:19+08:00","x_module":"util/gorm"}
{"host":"bogon","level":"info","msg":"PostgreSQL写库连接成功","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:19+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"bogon","level":"info","msg":"PostgreSQL读库连接成功","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:19+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"bogon","level":"info","msg":"[HTTP] server listening on: [::]:8280","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:20+08:00"}
{"host":"bogon","level":"info","msg":"[Request] Method: GET, Path: /api/v1/schedule/store/auth, Query: teacher_id=148&school_id=54&school_year_id=3&start_date=2025-04-14&end_date=2025-04-20, Body: ","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:22+08:00","trace_id":"1d8aec2bc9de2b38"}
{"host":"bogon","level":"debug","msg":"请求运营平台 API: http://ucenter-api.local.xiaoluxue.cn/api/v1/teacher/detail_by_token, token: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxNDgsInVzZXJuYW1lIjoi572X5rC45rWpIiwidXNlcl9waG9uZSI6IjE1NTQyOTAzODczIiwiZXhwIjoxNzQ1ODE1NDM5LCJpYXQiOjE3NDQwMTU0Mzl9.Yq0K3b59mw6-aKF4C29EtYSrF3MtRLMiErDgM3mINCc","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:22+08:00","trace_id":"1d8aec2bc9de2b38"}
{"host":"bogon","level":"debug","msg":"收到运营平台 API 响应, URL: http://ucenter-api.local.xiaoluxue.cn/api/v1/teacher/detail_by_token, 状态码: 200, 请求ID: , 响应内容: {\"status\":200,\"code\":0,\"message\":\"SUCCESS\",\"response_time\":1745315001,\"data\":{\"userID\":148,\"userName\":\"罗永浩\",\"userPhone\":\"15542903873\",\"teacherEmploymentStatus\":1,\"currentSchoolID\":0,\"userIsTest\":1,\"teacherJobInfos\":null,\"schoolInfos\":[{\"schoolID\":56,\"schoolName\":\"海淀一中\",\"schoolNumber\":\"SCH42\",\"schoolRegionID\":110108,\"schoolAddress\":\"北京市海淀区\",\"schoolEduLevel\":3,\"schoolEduSystem\":0,\"schoolNature\":1,\"schoolFeature\":1,\"schoolTag\":\"\",\"schoolIsTest\":0,\"schoolStatus\":1,\"remark\":\"\"}]}}","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:22+08:00","trace_id":"1d8aec2bc9de2b38"}
{"host":"bogon","level":"debug","msg":"成功获取教师信息: 148","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:22+08:00","trace_id":"1d8aec2bc9de2b38"}
{"host":"bogon","level":"debug","msg":"学段: 0, 学科: [], 教师ID: 148, 学校ID: 0","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:22+08:00","trace_id":"1d8aec2bc9de2b38"}
{"host":"bogon","level":"info","msg":"使用外部API路径，需要token验证: /api/v1/schedule/store/auth","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:22+08:00","trace_id":"1d8aec2bc9de2b38"}
{"host":"bogon","level":"info","msg":"使用外部API URL（需要token）: http://ucenter-api.local.xiaoluxue.cn/api/v1/teacher/weekSchedule?end_date=2025-04-20&school_id=54&school_year_id=3&start_date=2025-04-14&teacher_id=148","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:22+08:00","trace_id":"1d8aec2bc9de2b38"}
{"host":"bogon","level":"debug","msg":"设置Bearer token认证","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:22+08:00","trace_id":"1d8aec2bc9de2b38"}
{"host":"bogon","level":"info","msg":"正在发送课程表请求, URL: http://ucenter-api.local.xiaoluxue.cn/api/v1/teacher/weekSchedule?end_date=2025-04-20&school_id=54&school_year_id=3&start_date=2025-04-14&teacher_id=148","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:22+08:00","trace_id":"1d8aec2bc9de2b38"}
{"host":"bogon","level":"debug","msg":"收到API响应: {\"status\":200,\"code\":0,\"message\":\"获取课表成功\",\"response_time\":1745315001,\"data\":{\"schedule\":{\"1\":[],\"2\":[],\"3\":[],\"4\":[{\"schedule_id\":186,\"grade\":11,\"grade_name\":\"高一\",\"class_id\":14,\"class_name\":\"一班\",\"schedule_tpl_period_time_span\":\"下午\",\"schedule_tpl_period_start_time\":\"14:55:00\",\"schedule_tpl_period_end_time\":\"15:40:00\",\"class_schedule_course_id\":3,\"class_schedule_course\":\"英语\",\"class_schedule_teacher_id\":148,\"teacher_name\":\"罗永浩\",\"class_schedule_study_type\":1,\"class_schedule_study_type_name\":\"课程\",\"is_tmp\":0,\"at_day\":\"\",\"origin_schedule_id\":186,\"tmp_schedule_id\":0}],\"5\":[],\"6\":[{\"schedule_id\":0,\"grade\":11,\"grade_name\":\"高一\",\"class_id\":14,\"class_name\":\"一班\",\"schedule_tpl_period_time_span\":\"上午\",\"schedule_tpl_period_start_time\":\"08:55:00\",\"schedule_tpl_period_end_time\":\"09:40:00\",\"class_schedule_course_id\":3,\"class_schedule_course\":\"英语\",\"class_schedule_teacher_id\":148,\"teacher_name\":\"罗永浩\",\"class_schedule_study_type\":1,\"class_schedule_study_type_name\":\"课程\",\"is_tmp\":1,\"at_day\":\"2025-04-19\",\"origin_schedule_id\":0,\"tmp_schedule_id\":9}],\"7\":[]}}}","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:22+08:00","trace_id":"1d8aec2bc9de2b38"}
{"host":"bogon","level":"error","msg":"计算时间范围失败: parsing time \"4\" as \"2006-01-02\": cannot parse \"4\" as \"2006\"","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:22+08:00","trace_id":"1d8aec2bc9de2b38"}
{"host":"bogon","level":"error","msg":"计算时间范围失败: parsing time \"6\" as \"2006-01-02\": cannot parse \"6\" as \"2006\"","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:22+08:00","trace_id":"1d8aec2bc9de2b38"}
{"host":"bogon","level":"info","msg":"成功从API获取课程表数据","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:22+08:00","trace_id":"1d8aec2bc9de2b38"}
{"host":"bogon","level":"info","msg":"成功保存课程表数据到Redis, key: teacher_course:54:148","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:22+08:00","trace_id":"1d8aec2bc9de2b38"}
{"host":"bogon","level":"info","msg":"成功将教师(ID=148, 学校ID=54)添加到Redis列表","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:22+08:00","trace_id":"1d8aec2bc9de2b38"}
{"host":"bogon","level":"info","msg":"[Response] Method: GET, Path: /api/v1/schedule/store/auth, Status: 200, Duration: 139.143ms","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:22+08:00","trace_id":"1d8aec2bc9de2b38"}
{"host":"bogon","level":"info","msg":"[Request] Method: POST, Path: /api/v1/schedule/store/direct, Query: , Body: {\n  \"teacherId\": 148,\n  \"schoolId\": 54,\n  \"date\": \"2025-03-31\"\n}","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:25+08:00","trace_id":"15234968c0766d5e"}
{"host":"bogon","level":"debug","msg":"请求运营平台 API: http://ucenter-api.local.xiaoluxue.cn/api/v1/teacher/detail_by_token, token: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxNDgsInVzZXJuYW1lIjoi572X5rC45rWpIiwidXNlcl9waG9uZSI6IjE1NTQyOTAzODczIiwidXNlcl9zY2hvb2xfaWQiOjU2LCJleHAiOjE3NDYxNDE2NDksImlhdCI6MTc0NDM0MTY0OX0.isMPHTrcVaEFBwLZ8OR85DjqtsxptGokAVHGBuI0k3E","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:25+08:00","trace_id":"15234968c0766d5e"}
{"host":"bogon","level":"debug","msg":"收到运营平台 API 响应, URL: http://ucenter-api.local.xiaoluxue.cn/api/v1/teacher/detail_by_token, 状态码: 200, 请求ID: , 响应内容: {\"status\":200,\"code\":0,\"message\":\"SUCCESS\",\"response_time\":1745315004,\"data\":{\"userID\":148,\"userName\":\"罗永浩\",\"userPhone\":\"15542903873\",\"teacherEmploymentStatus\":1,\"currentSchoolID\":56,\"userIsTest\":1,\"teacherJobInfos\":[{\"schoolID\":56,\"jobType\":{\"jobType\":4,\"name\":\"学科教师\"},\"jobInfos\":[{\"jobGrade\":11,\"name\":\"高一\",\"jobClass\":[{\"jobClass\":14,\"name\":\"一班\"}]}],\"jobSubject\":{\"jobSubject\":3,\"name\":\"英语\"}}],\"schoolInfos\":[{\"schoolID\":56,\"schoolName\":\"海淀一中\",\"schoolNumber\":\"SCH42\",\"schoolRegionID\":110108,\"schoolAddress\":\"北京市海淀区\",\"schoolEduLevel\":3,\"schoolEduSystem\":0,\"schoolNature\":1,\"schoolFeature\":1,\"schoolTag\":\"\",\"schoolIsTest\":0,\"schoolStatus\":1,\"remark\":\"\"}]}}","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:26+08:00","trace_id":"15234968c0766d5e"}
{"host":"bogon","level":"debug","msg":"成功获取教师信息: 148","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:26+08:00","trace_id":"15234968c0766d5e"}
{"host":"bogon","level":"debug","msg":"学段: 3, 学科: [3], 教师ID: 148, 学校ID: 56","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:26+08:00","trace_id":"15234968c0766d5e"}
{"host":"bogon","level":"info","msg":"[Response] Method: POST, Path: /api/v1/schedule/store/direct, Status: 200, Duration: 78.509917ms","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:26+08:00","trace_id":"15234968c0766d5e"}
{"host":"bogon","level":"info","msg":"[Request] Method: GET, Path: /api/v1/schedule/is_teaching, Query: teacher_id=73&school_id=56, Body: ","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:28+08:00","trace_id":"30981b8e2e3204ae"}
{"host":"bogon","level":"debug","msg":"请求运营平台 API: http://ucenter-api.local.xiaoluxue.cn/api/v1/teacher/detail_by_token, token: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxNDgsInVzZXJuYW1lIjoi572X5rC45rWpIiwidXNlcl9waG9uZSI6IjE1NTQyOTAzODczIiwidXNlcl9zY2hvb2xfaWQiOjU2LCJleHAiOjE3NDYxNDE2NDksImlhdCI6MTc0NDM0MTY0OX0.isMPHTrcVaEFBwLZ8OR85DjqtsxptGokAVHGBuI0k3E","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:28+08:00","trace_id":"30981b8e2e3204ae"}
{"host":"bogon","level":"debug","msg":"收到运营平台 API 响应, URL: http://ucenter-api.local.xiaoluxue.cn/api/v1/teacher/detail_by_token, 状态码: 200, 请求ID: , 响应内容: {\"status\":200,\"code\":0,\"message\":\"SUCCESS\",\"response_time\":1745315006,\"data\":{\"userID\":148,\"userName\":\"罗永浩\",\"userPhone\":\"15542903873\",\"teacherEmploymentStatus\":1,\"currentSchoolID\":56,\"userIsTest\":1,\"teacherJobInfos\":[{\"schoolID\":56,\"jobType\":{\"jobType\":4,\"name\":\"学科教师\"},\"jobInfos\":[{\"jobGrade\":11,\"name\":\"高一\",\"jobClass\":[{\"jobClass\":14,\"name\":\"一班\"}]}],\"jobSubject\":{\"jobSubject\":3,\"name\":\"英语\"}}],\"schoolInfos\":[{\"schoolID\":56,\"schoolName\":\"海淀一中\",\"schoolNumber\":\"SCH42\",\"schoolRegionID\":110108,\"schoolAddress\":\"北京市海淀区\",\"schoolEduLevel\":3,\"schoolEduSystem\":0,\"schoolNature\":1,\"schoolFeature\":1,\"schoolTag\":\"\",\"schoolIsTest\":0,\"schoolStatus\":1,\"remark\":\"\"}]}}","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:28+08:00","trace_id":"30981b8e2e3204ae"}
{"host":"bogon","level":"debug","msg":"成功获取教师信息: 148","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:28+08:00","trace_id":"30981b8e2e3204ae"}
{"host":"bogon","level":"debug","msg":"学段: 3, 学科: [3], 教师ID: 148, 学校ID: 56","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:28+08:00","trace_id":"30981b8e2e3204ae"}
{"host":"bogon","level":"info","msg":"Redis中不存在课程表数据, key: teacher_course:56:73","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:28+08:00","trace_id":"30981b8e2e3204ae"}
{"host":"bogon","level":"info","msg":"[Response] Method: GET, Path: /api/v1/schedule/is_teaching, Status: 200, Duration: 66.569125ms","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:28+08:00","trace_id":"30981b8e2e3204ae"}
{"host":"bogon","level":"info","msg":"[Request] Method: GET, Path: /api/v1/behavior/class/latest-behaviors, Query: classId=2001, Body: ","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:31+08:00","trace_id":"45c31f95e7d78262"}
{"host":"bogon","level":"debug","msg":"请求运营平台 API: http://ucenter-api.local.xiaoluxue.cn/api/v1/teacher/detail_by_token, token: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxNDgsInVzZXJuYW1lIjoi572X5rC45rWpIiwidXNlcl9waG9uZSI6IjE1NTQyOTAzODczIiwiZXhwIjoxNzQ1ODI2MjY4LCJpYXQiOjE3NDQwMjYyNjh9.iZLT5LF9FDB5qhOvYqBkx8MU9EV-XOEY0Iv5980_RHw","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:31+08:00","trace_id":"45c31f95e7d78262"}
{"host":"bogon","level":"debug","msg":"收到运营平台 API 响应, URL: http://ucenter-api.local.xiaoluxue.cn/api/v1/teacher/detail_by_token, 状态码: 200, 请求ID: , 响应内容: {\"status\":200,\"code\":0,\"message\":\"SUCCESS\",\"response_time\":1745315010,\"data\":{\"userID\":148,\"userName\":\"罗永浩\",\"userPhone\":\"15542903873\",\"teacherEmploymentStatus\":1,\"currentSchoolID\":0,\"userIsTest\":1,\"teacherJobInfos\":null,\"schoolInfos\":[{\"schoolID\":56,\"schoolName\":\"海淀一中\",\"schoolNumber\":\"SCH42\",\"schoolRegionID\":110108,\"schoolAddress\":\"北京市海淀区\",\"schoolEduLevel\":3,\"schoolEduSystem\":0,\"schoolNature\":1,\"schoolFeature\":1,\"schoolTag\":\"\",\"schoolIsTest\":0,\"schoolStatus\":1,\"remark\":\"\"}]}}","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:31+08:00","trace_id":"45c31f95e7d78262"}
{"host":"bogon","level":"debug","msg":"成功获取教师信息: 148","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:31+08:00","trace_id":"45c31f95e7d78262"}
{"host":"bogon","level":"debug","msg":"学段: 0, 学科: [], 教师ID: 148, 学校ID: 0","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:31+08:00","trace_id":"45c31f95e7d78262"}
{"host":"bogon","level":"debug","msg":"获取班级(2001)学生最新行为成功，共8条记录","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:32+08:00","trace_id":"45c31f95e7d78262"}
{"host":"bogon","level":"info","msg":"[Response] Method: GET, Path: /api/v1/behavior/class/latest-behaviors, Status: 200, Duration: 32.612167ms","service_name":"gil_teacher","timestamp":"2025-04-22T17:43:32+08:00","trace_id":"45c31f95e7d78262"}
{"host":"bogon","level":"info","msg":"[HTTP] server stopping","service_name":"gil_teacher","timestamp":"2025-04-22T17:44:31+08:00"}
{"host":"bogon","level":"info","msg":"closing kafka producer client failed. err:<nil>","service_name":"gil_teacher","timestamp":"2025-04-22T17:44:31+08:00"}
{"host":"bogon","level":"info","msg":"closing kafka producer client success","service_name":"gil_teacher","timestamp":"2025-04-22T17:44:31+08:00"}
{"host":"bogon","level":"info","msg":"关闭ClickHouse连接...","service_name":"gil_teacher","timestamp":"2025-04-22T17:44:31+08:00"}
{"host":"bogon","level":"info","msg":"关闭PostgreSQL连接...","service_name":"gil_teacher","timestamp":"2025-04-22T17:44:31+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"bogon","level":"info","msg":"closing the data resources","service_name":"gil_teacher","timestamp":"2025-04-22T17:44:31+08:00"}
{"host":"bogon","level":"info","msg":"closing the data resources","service_name":"gil_teacher","timestamp":"2025-04-22T17:44:31+08:00","x_module":"data/NewActivityDB"}
