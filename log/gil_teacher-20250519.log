{"host":"localhost","level":"error","msg":"failed to initialize database, got error %v/Users/liyu/Go/gil_teacher/app/core/mysqlx/mysql.go:20Error 1045 (28000): Access denied for user 'root'@'10.1.70.251' (using password: YES) to database 'nacos'","service_name":"teacher-api","timestamp":"2025-05-19T11:44:33+08:00","x_module":"util/gorm"}
{"host":"localhost","level":"error","msg":"failed to initialize database, got error %v/Users/liyu/Go/gil_teacher/app/core/mysqlx/mysql.go:20Error 1045 (28000): Access denied for user 'root'@'10.1.70.251' (using password: YES) to database 'nacos'","service_name":"teacher-api","timestamp":"2025-05-19T11:44:34+08:00","x_module":"util/gorm"}
{"host":"localhost","level":"info","msg":"PostgreSQL写库连接成功","service_name":"teacher-api","timestamp":"2025-05-19T11:44:34+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"localhost","level":"info","msg":"PostgreSQL读库连接成功","service_name":"teacher-api","timestamp":"2025-05-19T11:44:34+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"localhost","level":"error","msg":"NewKafkaProducerClient kafkaConfig:&{Version:2.6.2 Brokers: Producer:{RetryMax:5 Timeout:10ns} Consumer:{AutoCommit:false CommitInterval:1ns MaxPollRecords:500 BatchSize:100 BatchTime:1ns SessionTime:600ns}} err: kafka: client has run out of available brokers to talk to: dial tcp: missing address","service_name":"teacher-api","timestamp":"2025-05-19T11:44:35+08:00"}
{"host":"localhost","level":"info","msg":"关闭ClickHouse连接...","service_name":"teacher-api","timestamp":"2025-05-19T11:44:35+08:00"}
{"host":"localhost","level":"info","msg":"关闭PostgreSQL连接...","service_name":"teacher-api","timestamp":"2025-05-19T11:44:35+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"localhost","level":"info","msg":"closing the data resources","service_name":"teacher-api","timestamp":"2025-05-19T11:44:35+08:00"}
{"host":"localhost","level":"info","msg":"closing the data resources","service_name":"teacher-api","timestamp":"2025-05-19T11:44:35+08:00","x_module":"data/NewActivityDB"}
{"host":"localhost","level":"error","msg":"failed to initialize database, got error %v/Users/liyu/Go/gil_teacher/app/core/mysqlx/mysql.go:20Error 1045 (28000): Access denied for user 'root'@'10.1.70.251' (using password: YES) to database 'nacos'","service_name":"teacher-api","timestamp":"2025-05-19T11:45:28+08:00","x_module":"util/gorm"}
{"host":"localhost","level":"error","msg":"failed to initialize database, got error %v/Users/liyu/Go/gil_teacher/app/core/mysqlx/mysql.go:20Error 1045 (28000): Access denied for user 'root'@'10.1.70.251' (using password: YES) to database 'nacos'","service_name":"teacher-api","timestamp":"2025-05-19T11:45:29+08:00","x_module":"util/gorm"}
{"host":"localhost","level":"info","msg":"PostgreSQL写库连接成功","service_name":"teacher-api","timestamp":"2025-05-19T11:45:29+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"localhost","level":"info","msg":"PostgreSQL读库连接成功","service_name":"teacher-api","timestamp":"2025-05-19T11:45:29+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"localhost","level":"error","msg":"NewKafkaProducerClient kafkaConfig:&{Version:2.6.2 Brokers: Producer:{RetryMax:5 Timeout:10ns} Consumer:{AutoCommit:false CommitInterval:1ns MaxPollRecords:500 BatchSize:100 BatchTime:1ns SessionTime:600ns}} err: kafka: client has run out of available brokers to talk to: dial tcp: missing address","service_name":"teacher-api","timestamp":"2025-05-19T11:45:30+08:00"}
{"host":"localhost","level":"info","msg":"关闭ClickHouse连接...","service_name":"teacher-api","timestamp":"2025-05-19T11:45:30+08:00"}
{"host":"localhost","level":"info","msg":"关闭PostgreSQL连接...","service_name":"teacher-api","timestamp":"2025-05-19T11:45:30+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"localhost","level":"info","msg":"closing the data resources","service_name":"teacher-api","timestamp":"2025-05-19T11:45:30+08:00"}
{"host":"localhost","level":"info","msg":"closing the data resources","service_name":"teacher-api","timestamp":"2025-05-19T11:45:30+08:00","x_module":"data/NewActivityDB"}
{"host":"localhost","level":"error","msg":"failed to initialize database, got error %v/Users/liyu/Go/gil_teacher/app/core/mysqlx/mysql.go:20Error 1045 (28000): Access denied for user 'root'@'10.1.70.251' (using password: YES) to database 'nacos'","service_name":"gil_teacher","timestamp":"2025-05-19T11:45:36+08:00","x_module":"util/gorm"}
{"host":"localhost","level":"error","msg":"failed to initialize database, got error %v/Users/liyu/Go/gil_teacher/app/core/mysqlx/mysql.go:20Error 1045 (28000): Access denied for user 'root'@'10.1.70.251' (using password: YES) to database 'nacos'","service_name":"gil_teacher","timestamp":"2025-05-19T11:45:36+08:00","x_module":"util/gorm"}
{"host":"localhost","level":"info","msg":"PostgreSQL写库连接成功","service_name":"gil_teacher","timestamp":"2025-05-19T11:45:37+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"localhost","level":"info","msg":"PostgreSQL读库连接成功","service_name":"gil_teacher","timestamp":"2025-05-19T11:45:37+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"localhost","level":"error","msg":"NewKafkaProducerClient kafkaConfig:&{Version:2.6.2 Brokers: Producer:{RetryMax:5 Timeout:10ns} Consumer:{AutoCommit:false CommitInterval:1ns MaxPollRecords:500 BatchSize:100 BatchTime:1ns SessionTime:600ns}} err: kafka: client has run out of available brokers to talk to: dial tcp: missing address","service_name":"gil_teacher","timestamp":"2025-05-19T11:45:37+08:00"}
{"host":"localhost","level":"info","msg":"关闭ClickHouse连接...","service_name":"gil_teacher","timestamp":"2025-05-19T11:45:37+08:00"}
{"host":"localhost","level":"info","msg":"关闭PostgreSQL连接...","service_name":"gil_teacher","timestamp":"2025-05-19T11:45:37+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"localhost","level":"info","msg":"closing the data resources","service_name":"gil_teacher","timestamp":"2025-05-19T11:45:37+08:00"}
{"host":"localhost","level":"info","msg":"closing the data resources","service_name":"gil_teacher","timestamp":"2025-05-19T11:45:37+08:00","x_module":"data/NewActivityDB"}
{"host":"localhost","level":"error","msg":"failed to initialize database, got error %v/Users/liyu/Go/gil_teacher/app/core/mysqlx/mysql.go:20Error 1045 (28000): Access denied for user 'root'@'10.1.70.251' (using password: YES) to database 'nacos'","service_name":"gil_teacher","timestamp":"2025-05-19T11:47:07+08:00","x_module":"util/gorm"}
{"host":"localhost","level":"error","msg":"failed to initialize database, got error %v/Users/liyu/Go/gil_teacher/app/core/mysqlx/mysql.go:20Error 1045 (28000): Access denied for user 'root'@'10.1.70.251' (using password: YES) to database 'nacos'","service_name":"gil_teacher","timestamp":"2025-05-19T11:47:07+08:00","x_module":"util/gorm"}
{"host":"localhost","level":"info","msg":"PostgreSQL写库连接成功","service_name":"gil_teacher","timestamp":"2025-05-19T11:47:07+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"localhost","level":"info","msg":"PostgreSQL读库连接成功","service_name":"gil_teacher","timestamp":"2025-05-19T11:47:07+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"localhost","level":"error","msg":"NewKafkaProducerClient kafkaConfig:&{Version:2.6.2 Brokers: Producer:{RetryMax:5 Timeout:10ns} Consumer:{AutoCommit:false CommitInterval:1ns MaxPollRecords:500 BatchSize:100 BatchTime:1ns SessionTime:600ns}} err: kafka: client has run out of available brokers to talk to: dial tcp: missing address","service_name":"gil_teacher","timestamp":"2025-05-19T11:47:08+08:00"}
{"host":"localhost","level":"info","msg":"关闭ClickHouse连接...","service_name":"gil_teacher","timestamp":"2025-05-19T11:47:08+08:00"}
{"host":"localhost","level":"info","msg":"关闭PostgreSQL连接...","service_name":"gil_teacher","timestamp":"2025-05-19T11:47:08+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"localhost","level":"info","msg":"closing the data resources","service_name":"gil_teacher","timestamp":"2025-05-19T11:47:08+08:00"}
{"host":"localhost","level":"info","msg":"closing the data resources","service_name":"gil_teacher","timestamp":"2025-05-19T11:47:08+08:00","x_module":"data/NewActivityDB"}
{"host":"localhost","level":"error","msg":"failed to initialize database, got error %v/Users/liyu/Go/gil_teacher/app/core/mysqlx/mysql.go:20Error 1045 (28000): Access denied for user 'root'@'10.1.70.251' (using password: YES) to database 'nacos'","service_name":"gil_teacher","timestamp":"2025-05-19T11:48:31+08:00","x_module":"util/gorm"}
{"host":"localhost","level":"error","msg":"failed to initialize database, got error %v/Users/liyu/Go/gil_teacher/app/core/mysqlx/mysql.go:20Error 1045 (28000): Access denied for user 'root'@'10.1.70.251' (using password: YES) to database 'nacos'","service_name":"gil_teacher","timestamp":"2025-05-19T11:48:31+08:00","x_module":"util/gorm"}
{"host":"localhost","level":"info","msg":"PostgreSQL写库连接成功","service_name":"gil_teacher","timestamp":"2025-05-19T11:48:31+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"localhost","level":"info","msg":"PostgreSQL读库连接成功","service_name":"gil_teacher","timestamp":"2025-05-19T11:48:31+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"localhost","level":"error","msg":"NewKafkaProducerClient kafkaConfig:&{Version:2.6.2 Brokers: Producer:{RetryMax:5 Timeout:10ns} Consumer:{AutoCommit:false CommitInterval:1ns MaxPollRecords:500 BatchSize:100 BatchTime:1ns SessionTime:600ns}} err: kafka: client has run out of available brokers to talk to: dial tcp: missing address","service_name":"gil_teacher","timestamp":"2025-05-19T11:48:32+08:00"}
{"host":"localhost","level":"info","msg":"关闭ClickHouse连接...","service_name":"gil_teacher","timestamp":"2025-05-19T11:48:32+08:00"}
{"host":"localhost","level":"info","msg":"关闭PostgreSQL连接...","service_name":"gil_teacher","timestamp":"2025-05-19T11:48:32+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"localhost","level":"info","msg":"closing the data resources","service_name":"gil_teacher","timestamp":"2025-05-19T11:48:32+08:00"}
{"host":"localhost","level":"info","msg":"closing the data resources","service_name":"gil_teacher","timestamp":"2025-05-19T11:48:32+08:00","x_module":"data/NewActivityDB"}
{"host":"localhost","level":"error","msg":"failed to initialize database, got error %v/Users/liyu/Go/gil_teacher/app/core/mysqlx/mysql.go:20Error 1045 (28000): Access denied for user 'root'@'10.1.70.251' (using password: YES) to database 'nacos'","service_name":"gil_teacher","timestamp":"2025-05-19T12:02:46+08:00","x_module":"util/gorm"}
{"host":"localhost","level":"error","msg":"failed to initialize database, got error %v/Users/liyu/Go/gil_teacher/app/core/mysqlx/mysql.go:20Error 1045 (28000): Access denied for user 'root'@'10.1.70.251' (using password: YES) to database 'nacos'","service_name":"gil_teacher","timestamp":"2025-05-19T12:02:46+08:00","x_module":"util/gorm"}
{"host":"localhost","level":"info","msg":"PostgreSQL写库连接成功","service_name":"gil_teacher","timestamp":"2025-05-19T12:02:46+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"localhost","level":"info","msg":"PostgreSQL读库连接成功","service_name":"gil_teacher","timestamp":"2025-05-19T12:02:46+08:00","x_module":"dao/NewPostgreSQLClient"}
{"host":"localhost","level":"info","msg":"[HTTP] server listening on: [::]:8280","service_name":"gil_teacher","timestamp":"2025-05-19T12:02:47+08:00"}
{"host":"localhost","level":"info","msg":"[Request] Method: GET, Path: /internal/api/v1/teachers, Query: , Body: ","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:23+08:00","trace_id":"47b14f959ca55b60"}
{"host":"localhost","level":"info","msg":"Redis中没有教师列表数据","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:23+08:00","trace_id":"47b14f959ca55b60"}
{"host":"localhost","level":"info","msg":"[Response] Method: GET, Path: /internal/api/v1/teachers, Status: 200, Duration: 40.79975ms","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:23+08:00","trace_id":"47b14f959ca55b60"}
{"host":"localhost","level":"info","msg":"[Request] Method: GET, Path: /api/v1/schedule/store/auth, Query: start_date=2025-04-30&end_date=2025-04-30&teacher_id=4&school_id=54&school_year_id=1, Body: ","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:31+08:00","trace_id":"54ee7e7c45eb3f62"}
{"host":"localhost","level":"debug","msg":"请求运营平台 API: http://ucenter-api.local.xiaoluxue.cn/api/v1/teacher/detail_by_token, token: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjo0LCJ1c2VybmFtZSI6IuadqOaWr-aWhyIsInVzZXJfcGhvbmUiOiJZV1prTVdVeU5qSXhNV1ZtWTJGa1lUYzFZalptT0RGall6QXlNemhrTlRjPSIsInVzZXJfc2Nob29sX2lkIjowLCJleHAiOjE3NDg4NDY1NjAsImlhdCI6MTc0NzA0NjU2MH0.6oEUZ6Kw6u4NPOmVyVBSPQ2gd_ZQLrkEQ6Wci2-Ilng","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:31+08:00","trace_id":"54ee7e7c45eb3f62"}
{"host":"localhost","level":"debug","msg":"收到运营平台 API 响应, URL: http://ucenter-api.local.xiaoluxue.cn/api/v1/teacher/detail_by_token, 状态码: 200, 请求ID: , 响应内容: {\"status\":200,\"code\":0,\"message\":\"SUCCESS\",\"response_time\":1747634603,\"data\":{\"userID\":4,\"userName\":\"杨斯文\",\"userPhone\":\"13269015927\",\"userPhoto\":\"http://gil-test.oss-cn-beijing.aliyuncs.com/admin/avatar/default.jpg\",\"teacherEmploymentStatus\":1,\"currentSchoolID\":2,\"userIsTest\":2,\"teacherJobInfos\":null,\"schoolInfos\":[{\"schoolID\":1,\"schoolName\":\"八一学校\",\"schoolNumber\":\"SCH1\",\"schoolRegionID\":110101,\"schoolAddress\":\"北京海淀区\",\"schoolEduLevel\":3,\"schoolEduSystem\":0,\"schoolNature\":2,\"schoolFeature\":0,\"schoolTag\":\"\",\"schoolIsTest\":0,\"schoolStatus\":2,\"remark\":\"\"}]}}","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:31+08:00","trace_id":"54ee7e7c45eb3f62"}
{"host":"localhost","level":"debug","msg":"成功获取教师信息: 4","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:31+08:00","trace_id":"54ee7e7c45eb3f62"}
{"host":"localhost","level":"debug","msg":"学段: 0, 学科: [], 教师ID: 4, 学校ID: 2","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:31+08:00","trace_id":"54ee7e7c45eb3f62"}
{"host":"localhost","level":"info","msg":"正在发送课程表请求, URL: http://ucenter-api.local.xiaoluxue.cn/internal/api/v1/teacher/weekSchedule?end_date=2025-04-30&school_id=54&school_year_id=1&start_date=2025-04-30&teacher_id=4","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:31+08:00","trace_id":"54ee7e7c45eb3f62"}
{"host":"localhost","level":"debug","msg":"收到API响应: {\"status\":200,\"code\":0,\"message\":\"获取课表成功\",\"response_time\":1747634603,\"data\":{\"schedule\":{\"3\":[{\"schedule_id\":29,\"grade\":11,\"grade_name\":\"高一\",\"class_id\":1,\"class_name\":\"一班\",\"schedule_tpl_period_time_span\":\"上午\",\"schedule_tpl_period_start_time\":\"08:00:00\",\"schedule_tpl_period_end_time\":\"08:40:00\",\"class_schedule_course_id\":1,\"class_schedule_course\":\"语文\",\"class_schedule_teacher_id\":4,\"teacher_name\":\"杨斯文\",\"class_schedule_study_type\":2,\"class_schedule_study_type_name\":\"学科自习\",\"is_tmp\":0,\"at_day\":\"\",\"origin_schedule_id\":29,\"tmp_schedule_id\":0},{\"schedule_id\":31,\"grade\":11,\"grade_name\":\"高一\",\"class_id\":1,\"class_name\":\"一班\",\"schedule_tpl_period_time_span\":\"上午\",\"schedule_tpl_period_start_time\":\"10:00:00\",\"schedule_tpl_period_end_time\":\"10:40:00\",\"class_schedule_course_id\":1,\"class_schedule_course\":\"语文\",\"class_schedule_teacher_id\":4,\"teacher_name\":\"杨斯文\",\"class_schedule_study_type\":1,\"class_schedule_study_type_name\":\"课程\",\"is_tmp\":0,\"at_day\":\"\",\"origin_schedule_id\":31,\"tmp_schedule_id\":0},{\"schedule_id\":33,\"grade\":11,\"grade_name\":\"高一\",\"class_id\":1,\"class_name\":\"一班\",\"schedule_tpl_period_time_span\":\"下午\",\"schedule_tpl_period_start_time\":\"15:00:00\",\"schedule_tpl_period_end_time\":\"15:40:00\",\"class_schedule_course_id\":1,\"class_schedule_course\":\"语文\",\"class_schedule_teacher_id\":4,\"teacher_name\":\"杨斯文\",\"class_schedule_study_type\":2,\"class_schedule_study_type_name\":\"学科自习\",\"is_tmp\":0,\"at_day\":\"\",\"origin_schedule_id\":33,\"tmp_schedule_id\":0},{\"schedule_id\":35,\"grade\":11,\"grade_name\":\"高一\",\"class_id\":1,\"class_name\":\"一班\",\"schedule_tpl_period_time_span\":\"晚上\",\"schedule_tpl_period_start_time\":\"20:00:00\",\"schedule_tpl_period_end_time\":\"20:40:00\",\"class_schedule_course_id\":1,\"class_schedule_course\":\"语文\",\"class_schedule_teacher_id\":4,\"teacher_name\":\"杨斯文\",\"class_schedule_study_type\":2,\"class_schedule_study_type_name\":\"学科自习\",\"is_tmp\":0,\"at_day\":\"\",\"origin_schedule_id\":35,\"tmp_schedule_id\":0}]}}}","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:31+08:00","trace_id":"54ee7e7c45eb3f62"}
{"host":"localhost","level":"debug","msg":"无法找到日期映射，键: 3","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:31+08:00","trace_id":"54ee7e7c45eb3f62"}
{"host":"localhost","level":"error","msg":"计算时间范围失败: parsing time \"3\" as \"2006-01-02\": cannot parse \"3\" as \"2006\"","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:31+08:00","trace_id":"54ee7e7c45eb3f62"}
{"host":"localhost","level":"error","msg":"计算时间范围失败: parsing time \"3\" as \"2006-01-02\": cannot parse \"3\" as \"2006\"","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:31+08:00","trace_id":"54ee7e7c45eb3f62"}
{"host":"localhost","level":"error","msg":"计算时间范围失败: parsing time \"3\" as \"2006-01-02\": cannot parse \"3\" as \"2006\"","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:31+08:00","trace_id":"54ee7e7c45eb3f62"}
{"host":"localhost","level":"error","msg":"计算时间范围失败: parsing time \"3\" as \"2006-01-02\": cannot parse \"3\" as \"2006\"","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:31+08:00","trace_id":"54ee7e7c45eb3f62"}
{"host":"localhost","level":"info","msg":"成功从API获取课程表数据","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:31+08:00","trace_id":"54ee7e7c45eb3f62"}
{"host":"localhost","level":"debug","msg":"过滤空数组后包含 1 个日期的课程","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:31+08:00","trace_id":"54ee7e7c45eb3f62"}
{"host":"localhost","level":"info","msg":"成功保存课程表数据到Redis, key: teacher_course:54:4","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:31+08:00","trace_id":"54ee7e7c45eb3f62"}
{"host":"localhost","level":"info","msg":"成功将教师(ID=4, 学校ID=54)添加到Redis列表","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:31+08:00","trace_id":"54ee7e7c45eb3f62"}
{"host":"localhost","level":"info","msg":"过滤空数组后包含 1 个日期的课程","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:31+08:00","trace_id":"54ee7e7c45eb3f62"}
{"host":"localhost","level":"info","msg":"[Response] Method: GET, Path: /api/v1/schedule/store/auth, Status: 200, Duration: 91.05575ms","service_name":"gil_teacher","timestamp":"2025-05-19T14:04:31+08:00","trace_id":"54ee7e7c45eb3f62"}
